"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateIt = exports.firstError = void 0;
const class_transformer_1 = require("class-transformer");
const class_validator_1 = require("class-validator");
const errors_1 = require("../errors");
const firstError = (errors) => {
    for (const error of errors) {
        if (error.contexts) {
            return Object.values(error.contexts).shift();
        }
        if (error.constraints) {
            return Object.values(error.constraints).shift();
        }
        if (error.children.length) {
            return (0, exports.firstError)(error.children);
        }
    }
    return null;
};
exports.firstError = firstError;
const validateIt = async (data, classType, groups) => {
    if (!data) {
        throw errors_1.PaymeErrors.InvalidRequest('Body should be object');
    }
    const classData = (0, class_transformer_1.plainToClass)(classType, data, { excludeExtraneousValues: false });
    const errors = await (0, class_validator_1.validate)(classData, { groups, whitelist: true });
    if (!errors || errors.length === 0) {
        return classData;
    }
    throw errors_1.PaymeErrors.InvalidRequest('Validation error');
};
exports.validateIt = validateIt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdmFsaWRhdG9ycy92YWxpZGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSx5REFBaUQ7QUFDakQscURBQTREO0FBQzVELHNDQUF3QztBQU1qQyxNQUFNLFVBQVUsR0FBRyxDQUFDLE1BQXlCLEVBQUUsRUFBRTtJQUVwRCxLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBRTtRQUV4QixJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUU7WUFDaEIsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNoRDtRQUVELElBQUksS0FBSyxDQUFDLFdBQVcsRUFBRTtZQUNuQixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ25EO1FBRUQsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRTtZQUN2QixPQUFPLElBQUEsa0JBQVUsRUFBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDckM7S0FDSjtJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUMsQ0FBQztBQWxCVyxRQUFBLFVBQVUsY0FrQnJCO0FBRUssTUFBTSxVQUFVLEdBQUcsS0FBSyxFQUFLLElBQUksRUFBRSxTQUF1QixFQUFFLE1BQU8sRUFBRSxFQUFFO0lBRTFFLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDUCxNQUFNLG9CQUFXLENBQUMsY0FBYyxDQUFDLHVCQUF1QixDQUFDLENBQUE7S0FDNUQ7SUFDRCxNQUFNLFNBQVMsR0FBRyxJQUFBLGdDQUFZLEVBQUMsU0FBUyxFQUFFLElBQVMsRUFBRSxFQUFFLHVCQUF1QixFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDekYsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDBCQUFRLEVBQUMsU0FBK0MsRUFBRSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUU1RyxJQUFJLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQ2hDLE9BQU8sU0FBUyxDQUFDO0tBQ3BCO0lBRUQsTUFBTSxvQkFBVyxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO0FBQ3hELENBQUMsQ0FBQztBQWJXLFFBQUEsVUFBVSxjQWFyQiIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgcGxhaW5Ub0NsYXNzIH0gZnJvbSAnY2xhc3MtdHJhbnNmb3JtZXInO1xuaW1wb3J0IHsgdmFsaWRhdGUsIFZhbGlkYXRpb25FcnJvciB9IGZyb20gJ2NsYXNzLXZhbGlkYXRvcic7XG5pbXBvcnQgeyBQYXltZUVycm9ycyB9IGZyb20gJy4uL2Vycm9ycyc7XG5cbmV4cG9ydCBkZWNsYXJlIHR5cGUgQ2xhc3NUeXBlPFQ+ID0ge1xuICAgIG5ldyguLi5hcmdzOiBhbnlbXSk6IFQ7XG59O1xuXG5leHBvcnQgY29uc3QgZmlyc3RFcnJvciA9IChlcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdKSA9PiB7XG5cbiAgICBmb3IgKGNvbnN0IGVycm9yIG9mIGVycm9ycykge1xuXG4gICAgICAgIGlmIChlcnJvci5jb250ZXh0cykge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZXJyb3IuY29udGV4dHMpLnNoaWZ0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXJyb3IuY29uc3RyYWludHMpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGVycm9yLmNvbnN0cmFpbnRzKS5zaGlmdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVycm9yLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZpcnN0RXJyb3IoZXJyb3IuY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG59O1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVJdCA9IGFzeW5jIDxUPihkYXRhLCBjbGFzc1R5cGU6IENsYXNzVHlwZTxUPiwgZ3JvdXBzPykgPT4ge1xuXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICAgIHRocm93IFBheW1lRXJyb3JzLkludmFsaWRSZXF1ZXN0KCdCb2R5IHNob3VsZCBiZSBvYmplY3QnKVxuICAgIH1cbiAgICBjb25zdCBjbGFzc0RhdGEgPSBwbGFpblRvQ2xhc3MoY2xhc3NUeXBlLCBkYXRhIGFzIFQsIHsgZXhjbHVkZUV4dHJhbmVvdXNWYWx1ZXM6IGZhbHNlIH0pO1xuICAgIGNvbnN0IGVycm9ycyA9IGF3YWl0IHZhbGlkYXRlKGNsYXNzRGF0YSBhcyB1bmtub3duIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LCB7IGdyb3Vwcywgd2hpdGVsaXN0OiB0cnVlIH0pO1xuXG4gICAgaWYgKCFlcnJvcnMgfHwgZXJyb3JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gY2xhc3NEYXRhO1xuICAgIH1cblxuICAgIHRocm93IFBheW1lRXJyb3JzLkludmFsaWRSZXF1ZXN0KCdWYWxpZGF0aW9uIGVycm9yJylcbn07XG4iXX0=